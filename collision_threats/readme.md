### Collision threat scenarios
---

This is a **helper** tool that parses recorded trackfiles from the INTERACTION dataset and tries to identify scenarios within those trackfiles in which two vehicles may be in risk of collision, i.e., its meant to help a developer identify these scenarios without having to watch visualizations for all trackfiles one by one. Specifically, the tool iterates over all timestamps of all trackfiles, and decides whether or not there is a collision risk between any two vehicles in the scene at those timestamps based on the proximities between each vehicle and their relative velocities. 

So, for any two vehicles in the scene, at any time, if 

- the distance (L2, magnitude of displacement vector) between the vehicles is lower than a certain threshold, AND
- the relative speed (magnitude of the velocity vector) of one vehicle to the other is higher than a certain threshold, AND
- the vehicles are moving towards each other, i.e., cosine similarity between the relative velocity vector and the displacement vector is lower than a certain threshold (so not necessarily head-to-head),

the tool identifies a collision threat between those two vehicles, at that timestamp.

**Limitations of the current version** 

- this is only a helper tool, i.e., it does not do any qualified prediction whether or not the collision will happen. I highly recommend double checking the output visually with the visualization tool provided in the "interaction-dataset" repository, and playing with the thresholds for different trackfiles/scenarios until you get a satisfying output. For a more rigorous definition and treatment of collision probability, see [1] and its related work. 

- the tool only uses the x/y co-ordinates provided by the "interaction-dataset", i.e., it cannot distinguish between large vehicles like trucks and smaller ones like passenger cars since it does not use the bounding box width/height information provided in the dataset. You can play with the thresholds to account for this for now.

- the tool does not know which vehicle (agent) is the perpetrator/victim (even though the source hints at that for better readability), and also, it only notes the starting point of a scenario, so the format/example for the lists generated by this tool is like the following (a bit different than the one recommended in the parent directory):

```csv
Scenario, File_id, StartTime_ms, agent1, agent2

DR_USA_Roundabout_FT,000,6000,13,12
```

Therefore, the lists generated by this tool should only serve as an aid to the developer who wants to extract legible simulation scenarios from the dataset, as explained in the first paragraph.

**Setup requirements**

- ["interaction-dataset" repository](https://github.com/interaction-dataset/interaction-dataset) and [this repository](https://github.com/interaction-dataset/interaction-dataset_selected_scenarios_list) are cloned to the same directory

- the dataset ("maps" + "recorded_trackfiles") is downloaded, and the files/folders are moved to their respective directories inside the "interaction-dataset" repository as instructed by its [readme file](https://github.com/interaction-dataset/interaction-dataset/blob/5dc5483a22c3394665b2b6c1401b19d9f194e4e1/README.md)

- the only package dependencies should be numpy and argparse.

**Adjusting thresholds and re-running the tool for generating the scenario lists**

The thresholds are hardcoded in src/tool_main.py. You can just change them and run the script to generate the scenario lists for the scenario and threshold set you want. The scenario lists, which are csv files that follow the format described in the parent directory, are saved under the directory "lists".

I've generated the scenario list for trackfiles from a chosen example scenario ("DR_DEU_Merging_MT") using the default thresholds and saved those scenario lists under "lists" as examples. 


[1] N. Kaempchen, "Situation Assessment of an Autonomous Emergency Brake for Arbitrary V2V Collision Scenarios" 